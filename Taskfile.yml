version: "3"

tasks:
  analytics:sync:
    desc: Install/sync Python dependencies
    dir: projects/analytics-au
    cmd: uv sync

  analytics:dev:
    desc: Start Dagster dev server
    dir: projects/analytics-au
    env:
      DAGSTER_HOME: "{{.ROOT_DIR}}/.dagster_home"
    cmd: uv run dg dev

  analytics:dbt-build:
    desc: Build dbt models directly
    dir: projects/analytics-au
    cmd: uv run dbt build --project-dir dbt_project

  reports:install:
    desc: Install Node dependencies
    dir: reports/au
    cmd: npm install

  reports:sources:
    desc: Extract DuckDB data into Evidence cache
    dir: reports/au
    cmd: npm run sources

  reports:dev:
    desc: Start Evidence dev server
    dir: reports/au
    cmd: npm run dev

  reports:build:
    desc: Build static Evidence site
    dir: reports/au
    cmd: npm run build

  dev:
    desc: Start both Dagster and Evidence dev servers
    deps:
      - analytics:dev
      - reports:dev

  analytics:harlequin:
    desc: Launch Harlequin SQL IDE on the analytics DuckDB
    dir: projects/analytics-au
    cmd: uv run harlequin analytics.duckdb

  setup:
    desc: One-shot project setup (Python + Node deps)
    cmds:
      - task: analytics:sync
      - task: reports:install
